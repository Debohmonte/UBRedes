<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Facturas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        h1 {
            text-align: center;
        }
        form {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            box-sizing: border-box;
        }
        button {
            display: inline-block;
            padding: 10px 20px;
            margin: 20px 0;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
        }
        table {
            width: 100%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>Gestión de Facturas</h1>

    <form id="formFactura" method="POST" action="alta_factura.php" enctype="multipart/form-data">
        <label for="nro_factura">Número de Factura</label>
        <input type="text" id="nro_factura" name="nro_factura" required placeholder="0001-00000001">

        <label for="cuil_emisor">CUIL Emisor</label>
        <input type="text" id="cuil_emisor" name="cuil_emisor" required placeholder="20-12345678-9">

        <label for="cuil_receptor">CUIL Receptor</label>
        <input type="text" id="cuil_receptor" name="cuil_receptor" required placeholder="20-98765432-1">

        <label for="monto">Monto</label>
        <input type="number" id="monto" name="monto" required placeholder="2500.00" step="0.01">

        <label for="descripcion">Descripción</label>
        <input type="text" id="descripcion" name="descripcion" required placeholder="Servicio Consultoría">

        <label for="iva">IVA</label>
        <input type="number" id="iva" name="iva" required placeholder="10.50" step="0.01">

        <label for="tipo_id">Tipo de Factura</label>
        <select id="tipo_id" name="tipo_id">
            <option value="1">Factura A</option>
            <option value="2">Factura B</option>
            <option value="3">Factura C</option>
        </select>

        <label for="fecha">Fecha</label>
        <input type="date" id="fecha" name="fecha" required>

        <button type="submit">Guardar Factura</button>
    </form>

    <h2>Facturas Existentes</h2>
    <table>
        <thead>
            <tr>
                <th>Número de Factura</th>
                <th>CUIL Emisor</th>
                <th>CUIL Receptor</th>
                <th>Monto</th>
                <th>Descripción</th>
                <th>IVA</th>
                <th>Total</th>
                <th>Tipo</th>
                <th>Fecha</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tablaFacturas">
            <!-- Data from the database will be inserted here dynamically -->
            <?php
            require 'db_connection.php';
            $stmt = $dbh->query("SELECT factura.*, tipo.nombre_tipo 
                                FROM factura
                                JOIN tipo ON factura.tipo_id = tipo.id");
            while ($factura = $stmt->fetch(PDO::FETCH_ASSOC)) {
                echo "<tr>
                        <td>{$factura['nro_factura']}</td>
                        <td>{$factura['cuil_emisor']}</td>
                        <td>{$factura['cuil_receptor']}</td>
                        <td>{$factura['monto']}</td>
                        <td>{$factura['descripcion']}</td>
                        <td>{$factura['iva']}</td>
                        <td>{$factura['total']}</td>
                        <td>{$factura['nombre_tipo']}</td>
                        <td>{$factura['fecha']}</td>
                        <td>
                            <a href='modi_factura.php?id={$factura['id']}'>Editar</a> |
                            <a href='baja_factura.php?id={$factura['id']}'>Borrar</a>
                        </td>
                    </tr>";
            }
            ?>
        </tbody>
    </table>

</body>
</html>
